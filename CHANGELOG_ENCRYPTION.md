# Changelog: –ü–æ–ª–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

## [3.2.0] - 2025-10-20

### üîê –î–æ–±–∞–≤–ª–µ–Ω–æ - –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

#### –ù–æ–≤—ã–µ –º–æ–¥—É–ª–∏:
- **app/encryption.py** - –£—Ç–∏–ª–∏—Ç—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è/—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
  - `encrypt_data()` / `decrypt_data()` - –¥–ª—è —Å—Ç—Ä–æ–∫
  - `encrypt_datetime()` / `decrypt_datetime()` - –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
  - `encrypt_json()` / `decrypt_json()` - –¥–ª—è JSON –æ–±—ä–µ–∫—Ç–æ–≤
  - `encrypt_int()` / `decrypt_int()` - –¥–ª—è —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª

- **app/redis_encrypted.py** - –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è Redis —Å –∞–≤—Ç–æ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
  - `EncryptedRedisClient` - –∫–ª–∞—Å—Å —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
  - `wrap_redis_client()` - —Ñ—É–Ω–∫—Ü–∏—è –æ–±–µ—Ä—Ç–∫–∏
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è `csrf:*`, `device:*`, `push:*`

#### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (app/models.py):

**User:**
- `encrypted_avatar_mime` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π MIME —Ç–∏–ø –∞–≤–∞—Ç–∞—Ä–∞
- `encrypted_last_activity` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- `encrypted_e2e_key_updated` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è E2E –∫–ª—é—á–∞

**Chat:**
- `encrypted_name` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞/–∫–∞–Ω–∞–ª–∞
- `encrypted_created_at` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
- `encrypted_invite_code` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è

**ChatMember:**
- `encrypted_joined_at` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

**UserSession:**
- `encrypted_device_type` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `encrypted_device_name` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `encrypted_ip_address` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π IP –∞–¥—Ä–µ—Å
- `encrypted_user_agent` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π User-Agent
- `encrypted_created_at` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
- `encrypted_last_activity` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**UserStatus:**
- `encrypted_last_seen` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∏–∑–∏—Ç–∞
- `encrypted_updated_at` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**MessageReadStatus:**
- `encrypted_last_read_message_id` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π UUID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ
- `encrypted_read_at` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è
- `encrypted_updated_at` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –°–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏:
- **migrate_encrypt_data.py** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ dry-run —Ä–µ–∂–∏–º–∞
  - –ú–∏–≥—Ä–∞—Ü–∏—è MySQL (6 —Ç–∞–±–ª–∏—Ü, 23 –ø–æ–ª—è)
  - –ú–∏–≥—Ä–∞—Ü–∏—è Redis (3 —Ç–∏–ø–∞ –∫–ª—é—á–µ–π)
  - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- **migration_add_encrypted_fields.sql** - SQL —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
  - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ Deprecated –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–µ–π
  - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–µ–π

#### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- **ENCRYPTION_ANALYSIS.md** - –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **ENCRYPTION_IMPLEMENTATION.md** - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é
- **ENCRYPTION_SUMMARY.md** - –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ
- **CHANGELOG_ENCRYPTION.md** - –≠—Ç–æ—Ç —Ñ–∞–π–ª

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### –£–ª—É—á—à–µ–Ω–∏—è:
- –í—Å–µ PII –¥–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –≤ MySQL (95% –ø–æ–∫—Ä—ã—Ç–∏–µ)
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ Redis –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã
- –ó–∞—â–∏—Ç–∞ –æ—Ç —É—Ç–µ—á–µ–∫ –¥–∞–º–ø–æ–≤ –ë–î
- Zero-knowledge –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π (—Ä–∞–∑ –≤ –º–µ—Å—è—Ü)

#### –ê–ª–≥–æ—Ä–∏—Ç–º:
- **AES-256-GCM** - authenticated encryption
- **Nonce:** 12 –±–∞–π—Ç, —Å–ª—É—á–∞–π–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- **Tag:** 16 –±–∞–π—Ç –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–ö–ª—é—á:** 32 –±–∞–π—Ç–∞ –∏–∑ `ENCRYPTION_KEY_STR`

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

#### –ó–∞—â–∏—â–µ–Ω–æ:
- **MySQL:** 23 –Ω–æ–≤—ã—Ö –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—è
- **Redis:** 3 —Ç–∏–ø–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π
- **–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** 95% –¥–∞–Ω–Ω—ã—Ö

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ: ~0.1-0.5 –º—Å/–æ–ø–µ—Ä–∞—Ü–∏—è
- –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: <1%
- –ê–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ: AES-NI

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ

#### –ú–æ–¥–µ–ª–∏:
- –°—Ç–∞—Ä—ã–µ –ø–æ–ª—è –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `Deprecated`
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ SQL
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
- –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è Redis
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

### ‚ö†Ô∏è Deprecated

–°–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ (–±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –≤ v4.0.0):

**users:**
- `avatar_mime` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_avatar_mime`
- `e2e_key_updated` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_e2e_key_updated`
- `last_activity` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_last_activity`

**chats:**
- `name` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_name`
- `created_at` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_created_at`
- `invite_code` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_invite_code`

**chat_members:**
- `joined_at` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_joined_at`

**user_sessions:**
- `device_type` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_device_type`
- `device_name` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_device_name`
- `ip_address` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_ip_address`
- `user_agent` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_user_agent`
- `created_at` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_created_at`
- `last_activity` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_last_activity`

**user_statuses:**
- `last_seen` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_last_seen`
- `updated_at` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_updated_at`

**message_read_statuses:**
- `last_read_message_id` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_last_read_message_id`
- `read_at` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_read_at`
- `updated_at` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `encrypted_updated_at`

### üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏

#### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

1. **–û–±–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   pip install -r requirements.txt
   ```

2. **–î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—è –≤ –ë–î:**
   ```bash
   mysql -u user -p mvp_db < migration_add_encrypted_fields.sql
   ```

3. **–ú–∏–≥—Ä–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ:**
   ```bash
   # –¢–µ—Å—Ç
   python migrate_encrypt_data.py --dry-run
   
   # –†–µ–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
   python migrate_encrypt_data.py
   ```

4. **–û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥:**
   ```python
   # –°—Ç–∞—Ä—ã–π –∫–æ–¥
   user.avatar_mime = "image/png"
   
   # –ù–æ–≤—ã–π –∫–æ–¥
   from app.encryption import encrypt_data
   user.encrypted_avatar_mime = encrypt_data("image/png")
   ```

5. **–î–ª—è Redis:**
   ```python
   # –°—Ç–∞—Ä—ã–π –∫–æ–¥
   await redis_client.set(f"csrf:{user_id}", token)
   
   # –ù–æ–≤—ã–π –∫–æ–¥
   from app.redis_encrypted import wrap_redis_client
   encrypted_redis = wrap_redis_client(redis_client)
   await encrypted_redis.set(f"csrf:{user_id}", token)
   ```

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

- –£—Ç–µ—á–∫–∞ PII –≤ –ª–æ–≥–∞—Ö (–¥–æ–±–∞–≤–ª–µ–Ω–∞ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞)
- –ù–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
- –ù–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã–µ IP –∞–¥—Ä–µ—Å–∞ –≤ —Å–µ—Å—Å–∏—è—Ö
- –û—Ç–∫—Ä—ã—Ç—ã–µ –∫–æ–¥—ã –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π –≤ —á–∞—Ç–∞—Ö

### üöÄ –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ

#### v3.3.0:
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å HSM –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–µ–π
- [ ] Key derivation —Å PBKDF2/Argon2
- [ ] Audit logging –¥–ª—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### v4.0.0:
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ deprecated –ø–æ–ª–µ–π
- [ ] Field-level encryption –Ω–∞ —É—Ä–æ–≤–Ω–µ ORM
- [ ] –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
- [ ] Compliance —Å GDPR/CCPA

### üìñ –°—Å—ã–ª–∫–∏

- [–ê–Ω–∞–ª–∏–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è](ENCRYPTION_ANALYSIS.md)
- [–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é](ENCRYPTION_IMPLEMENTATION.md)
- [–ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ](ENCRYPTION_SUMMARY.md)
- [–û—Å–Ω–æ–≤–Ω–æ–π Changelog](CHANGELOG_SESSIONS_STATUS.md)

### üë• –ê–≤—Ç–æ—Ä—ã

- Pixeltoo Lab - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- MVP Team - Code review –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Proprietary - Pixeltoo Lab

---

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è: "–°–µ—Ä–≤–µ—Ä –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–µ—Ç –æ –≤–∞—Å!" - –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê ‚úÖ**
