# ‚úÖ –í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ó–ê–í–ï–†–®–ï–ù–´

## –î–∞—Ç–∞: 2025-10-20

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ –ü–û–õ–ù–û–°–¢–¨–Æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∏–ª–æ—Å—å 2 —Ä–∞–∑–∞
- –ú–µ—Ç–æ–¥—ã `d()`, `i()`, `w()` —Å–æ–∑–¥–∞–≤–∞–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ–ø–∏—Å–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –ª–æ–≥–≥–µ—Ä–∞
- –£–±—Ä–∞–Ω—ã –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã
- –¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –¥–µ–ª–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω `print()`

**–§–∞–π–ª:** `lib/core/utils/logger.dart`

```dart
// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
static void d(String message, [String? tag]) {
  if (kDebugMode || _enableReleaseLogging) {
    print('$_logPrefix üîµ [${tag ?? _tag}] $message');
  }
}
```

---

### 2. ‚úÖ –û—à–∏–±–∫–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
‚ùå Message decryption failed
Error: –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
```
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—ã—Ç–∞–ª–æ—Å—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è `call_signal`
- –≠—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (`call_signal`, `call_end`, `call_accept`) –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- –û—à–∏–±–∫–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –±–æ–ª—å—à–µ –Ω–µ –≤—ã–≤–æ–¥—è—Ç—Å—è

**–§–∞–π–ª:** `lib/presentation/providers/message_provider.dart`

```dart
// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è
final msgData = data as Map<String, dynamic>;
final msgType = msgData['type'] as String?;

// –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
if (msgType == 'call_signal' || msgType == 'call_end' || msgType == 'call_accept') {
  return null;
}
```

---

### 3. ‚úÖ –û—à–∏–±–∫–∞ sessions type cast –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
‚ùå Failed to load sessions
Error: type 'Null' is not a subtype of type 'List<dynamic>' in type cast
```
- –ü—Ä–∏ 401 –æ—à–∏–±–∫–µ `sessions` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `null`
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—ã—Ç–∞–ª–æ—Å—å –ø—Ä–∏–≤–µ—Å—Ç–∏ `null` –∫ `List`

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `null`
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤

**–§–∞–π–ª:** `lib/presentation/providers/session_provider.dart`

```dart
final sessionsData = response['sessions'] as List<dynamic>?;

if (sessionsData == null) {
  state = state.copyWith(
    sessions: [],
    isLoading: false,
  );
  return;
}
```

---

### 4. ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—É—á–∞–µ–º—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –î–µ—Ç–∞–ª—å–Ω—ã–π payload –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (–∫—Ä–æ–º–µ ping/pong)

**–§–∞–π–ª:** `lib/data/data_sources/remote/websocket_client.dart`

```dart
// –û—Ç–ø—Ä–∞–≤–∫–∞
AppLogger.ws('‚Üí $msgType to $target');
if (msgType != 'ping' && msgType != 'pong') {
  AppLogger.d('WS Send: $message', 'WS');
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ
AppLogger.ws('‚Üê $type from $from');
if (type != 'ping' && type != 'pong') {
  AppLogger.d('WS Received: $message', 'WS');
}
```

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```
flutter: üî∑ MVP_CLIENT üîå [WEBSOCKET] ‚Üí ping to null
flutter: üîµ üî∑ MVP_CLIENT [WEBSOCKET] ‚Üí ping to null
flutter: ‚ùå üî∑ MVP_CLIENT [E2E] ‚ùå Message decryption failed
flutter: ‚ùå üî∑ MVP_CLIENT [Sessions] ‚ùå Failed to load sessions
flutter: üî∑ MVP_CLIENT   Error: type 'Null' is not a subtype of type 'List<dynamic>'
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```
flutter: üî∑ MVP_CLIENT üîå [WEBSOCKET] ‚Üí ping to null
flutter: üî∑ MVP_CLIENT üîå [WEBSOCKET] ‚Üê pong from server
flutter: üî∑ MVP_CLIENT üîµ [WS] WS Send: {type: message, data: –ø—Ä–∏–≤–µ—Ç}
flutter: üî∑ MVP_CLIENT üîµ [WS] WS Received: {type: message, from: 26040983}
flutter: üî∑ MVP_CLIENT ‚ÑπÔ∏è  [Sessions] Loaded 4 sessions
```

---

## üìù –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´

1. ‚úÖ `lib/core/utils/logger.dart` - –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –ª–æ–≥–≥–µ—Ä
2. ‚úÖ `lib/presentation/providers/message_provider.dart` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
3. ‚úÖ `lib/presentation/providers/session_provider.dart` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ null
4. ‚úÖ `lib/data/data_sources/remote/websocket_client.dart` - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
5. ‚úÖ `lib/main.dart` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∫–ª—é—á —Ç–æ–∫–µ–Ω–∞
6. ‚úÖ `lib/presentation/screens/main/home_screen.dart` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫

---

## üéØ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è - –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ 1 —Ä–∞–∑
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ WebSocket (–æ—Ç–ø—Ä–∞–≤–∫–∞/–ø–æ–ª—É—á–µ–Ω–∏–µ)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ UI
- ‚úÖ –ß–∏—Å—Ç—ã–π –≤—ã–≤–æ–¥ –±–µ–∑ –º—É—Å–æ—Ä–∞

### –û—à–∏–±–∫–∏
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ call_signal
- ‚úÖ –ù–µ—Ç type cast –æ—à–∏–±–æ–∫ –≤ sessions
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ 401 –æ—à–∏–±–æ–∫
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ null –∑–Ω–∞—á–µ–Ω–∏–π

### WebSocket
- ‚úÖ –¢–æ–∫–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Ping/pong —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∏ –ø–æ–ª—É—á–∞—é—Ç—Å—è

---

## üöÄ –ß–¢–û –î–ï–õ–ê–¢–¨

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   flutter run
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   - –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è ‚úÖ
   - –ù–µ—Ç –æ—à–∏–±–æ–∫ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ ‚úÖ
   - –ù–µ—Ç type cast –æ—à–∏–±–æ–∫ ‚úÖ
   - WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   ```
   üî∑ MVP_CLIENT üîÑ [LIFECYCLE] üöÄ Application starting...
   üî∑ MVP_CLIENT ‚ÑπÔ∏è  [Main] Token from storage: exists (550 chars)
   üî∑ MVP_CLIENT üîå [WEBSOCKET] ‚Üí ping to null
   üî∑ MVP_CLIENT üîå [WEBSOCKET] ‚Üê pong from server
   üî∑ MVP_CLIENT üé® [UI_EVENT] üîò –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞: –ù–∞—Å—Ç—Ä–æ–π–∫–∏
   ```

---

## ‚ö†Ô∏è –ò–ó–í–ï–°–¢–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ)

### 401 –û—à–∏–±–∫–∏
- –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (–≤ –±—É–¥—É—â–µ–º)

### Connection closed
- –ò–Ω–æ–≥–¥–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Å–µ—Ç–∏
- **–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –µ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

---

## ‚úÖ –ò–¢–û–ì–ò

- ‚úÖ **–í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã**
- ‚úÖ **–õ–æ–≥–∏ —á–∏—Å—Ç—ã–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ**
- ‚úÖ **WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ**
- ‚úÖ **UI –æ—Ç–∑—ã–≤—á–∏–≤—ã–π –±–µ–∑ –∫—Ä–∞—à–µ–π**
- ‚úÖ **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é**

---

**–í—Å–µ –≥–æ—Ç–æ–≤–æ! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫.** üéâ
